# Windows 应用打包与分发指南

本指南说明如何将项目打包成 Windows 可执行文件，以便在没有安装任何依赖的 Windows 机器上直接运行。

## 前提条件

在**打包机器**上需要安装：
- Node.js 16+ （下载地址：https://nodejs.org/）
- npm（通常随 Node.js 一起安装）

**注意**：目标机器（用户使用的机器）**不需要**安装任何软件，只需要 Windows 操作系统。

## 打包步骤

### 1. 安装项目依赖

在项目根目录执行：

```bash
npm install
```

如果安装很慢，项目已配置国内镜像（`.npmrc`），或参考 `QUICK_START.md` 中的说明。

### 2. 执行打包命令

```bash
npm run electron:build
```

这个命令会：
1. 清理之前的构建文件
2. 构建前端代码（Vite）
3. 使用 electron-builder 打包成 Windows 安装程序

### 3. 打包输出

打包完成后，在 `release/` 目录下会生成：

- **`房源记录 Setup 1.0.0.exe`** - Windows 安装程序（推荐分发这个）
- **`win-unpacked/`** - 未打包的应用文件夹（包含所有文件）

## 分发方式

### 方式 1：分发安装程序（推荐）

**文件**：`release/房源记录 Setup 1.0.0.exe`

**优点**：
- 用户双击即可安装
- 自动创建桌面快捷方式
- 可以通过控制面板卸载
- 专业、规范

**使用方法**：
1. 将 `房源记录 Setup 1.0.0.exe` 复制到 U盘、网盘或通过其他方式传输给用户
2. 用户在目标机器上双击运行
3. 按照安装向导完成安装
4. 安装完成后，可以从开始菜单或桌面快捷方式启动应用

**安装位置**：
- 默认：`C:\Users\<用户名>\AppData\Local\Programs\房源记录\`
- 用户可以选择其他安装位置

### 方式 2：分发未打包文件夹（便携版）

**文件夹**：`release/win-unpacked/`

**优点**：
- 无需安装，解压即用
- 可以放在 U盘 中运行
- 适合临时使用

**使用方法**：
1. 将整个 `win-unpacked` 文件夹压缩成 ZIP 文件
2. 传输给用户
3. 用户解压后，双击 `房源记录.exe` 即可运行

**注意**：
- 首次运行可能较慢（Windows 需要验证文件）
- 如果被杀毒软件拦截，需要添加信任
- 数据文件会保存在 `win-unpacked/data/markers.json`

## 文件大小说明

打包后的文件大小：
- **安装程序**：约 150-200 MB（包含 Electron 运行时和所有依赖）
- **未打包文件夹**：约 200-300 MB

这是正常的，因为 Electron 应用需要包含 Chromium 浏览器内核和 Node.js 运行时。

## 用户使用说明

### 首次运行

1. 如果使用安装程序：
   - 双击 `房源记录 Setup 1.0.0.exe`
   - 按照向导完成安装
   - 从开始菜单或桌面快捷方式启动

2. 如果使用便携版：
   - 解压 ZIP 文件
   - 双击 `房源记录.exe`
   - 如果 Windows 显示安全警告，点击"更多信息" → "仍要运行"

### 数据存储位置

**安装版**：
- 数据文件：`C:\Users\<用户名>\AppData\Local\Programs\房源记录\data\markers.json`

**便携版**：
- 数据文件：`<解压目录>\win-unpacked\data\markers.json`

### 数据迁移

如果用户需要在另一台机器上使用，可以：
1. 在应用中使用"导出数据"功能
2. 在新机器上使用"导入数据"功能
3. 或者直接复制 `data/markers.json` 文件到新机器的对应位置

## 常见问题

### 1. 打包失败：找不到图标文件

**问题**：如果提示找不到 `build/icon.ico`

**解决**：
- 方案 1：创建 `build` 目录，放入 `icon.ico` 文件
- 方案 2：修改 `package.json`，移除图标配置（应用会使用默认图标）

### 2. 用户运行时报错：无法启动

**可能原因**：
- Windows 版本过旧（需要 Windows 7 或更高版本）
- 被杀毒软件拦截
- 文件损坏

**解决**：
- 检查 Windows 版本
- 添加杀毒软件信任
- 重新下载/传输文件

### 3. 应用启动很慢

**原因**：首次启动需要加载 Electron 运行时，这是正常的。

**解决**：等待几秒钟即可，后续启动会更快。

### 4. 高德地图无法显示

**原因**：需要网络连接访问高德地图 API

**解决**：确保目标机器已连接互联网

## 高级配置

### 自定义应用图标

1. 准备图标文件：
   - Windows：`icon.ico`（256x256 像素，包含多个尺寸）
   - 可以使用在线工具转换：https://convertio.co/zh/png-ico/

2. 创建 `build` 目录，放入图标文件：
   ```
   build/
   └── icon.ico
   ```

3. `package.json` 中已配置图标路径，无需修改

### 修改应用名称

在 `package.json` 中修改：
```json
{
  "build": {
    "productName": "你的应用名称"
  }
}
```

### 修改版本号

在 `package.json` 中修改：
```json
{
  "version": "1.0.1"
}
```

## 自动化打包脚本（可选）

可以创建一个批处理文件 `build.bat`：

```batch
@echo off
echo 开始打包...
call npm run electron:build
echo 打包完成！
echo 安装程序位置: release\房源记录 Setup *.exe
pause
```

双击运行即可自动打包。

## 总结

1. **开发机器**：需要 Node.js 和 npm，执行 `npm run electron:build`
2. **用户机器**：只需要 Windows，无需安装任何软件
3. **分发文件**：`release/房源记录 Setup 1.0.0.exe`（安装程序）或 `release/win-unpacked/`（便携版）
4. **数据存储**：应用会自动在安装目录下创建 `data` 文件夹存储数据

打包一次，可以在任何 Windows 机器上使用！
